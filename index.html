<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Secret Santa Spin</title>

  <!-- Cute rounded font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      box-sizing: border-box;
    }

    /* üéÑ PAGE BACKGROUND WITH IMAGE + OVERLAY + SNOW */
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      font-family: "Poppins", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: #111827;

      /* Background image */
      background-image: url("https://cdn.britannica.com/91/196391-050-AA4AE4BC/room-fireplace-armchair-Christmas-tree-gifts.jpg");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;

      position: relative;
      overflow-x: hidden;
    }

    /* dark overlay + slight blur so card is readable */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.35);
      backdrop-filter: blur(2px);
      z-index: 0;
    }

    /* soft snow layer */
    body::after {
      content: "";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background-image:
        radial-gradient(2px 2px at 20% 10%, rgba(255,255,255,0.7) 0, transparent 60%),
        radial-gradient(3px 3px at 80% 30%, rgba(255,255,255,0.8) 0, transparent 60%),
        radial-gradient(2px 2px at 50% 70%, rgba(255,255,255,0.6) 0, transparent 60%);
      background-repeat: repeat;
      opacity: 0.75;
      animation: snow 20s linear infinite;
      z-index: 0;
    }

    @keyframes snow {
      0%   { transform: translateY(-10px); }
      100% { transform: translateY(30px); }
    }

    .card {
      position: relative;
      z-index: 1;
      background: linear-gradient(145deg, #ffffff, #fff7f7);
      padding: 28px 24px 32px;
      border-radius: 24px;
      max-width: 520px;
      width: 100%;
      box-shadow: 0 20px 55px rgba(0,0,0,0.45);
      border: 2px solid #fecaca;
    }

    .title-row {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .title-row span.icon {
      font-size: 30px;
      filter: drop-shadow(0 3px 4px rgba(0,0,0,0.18));
    }

    h1 {
      margin: 0;
      font-size: 1.8rem;
      color: #f97373;
      letter-spacing: 0.09em;
      text-transform: uppercase;
    }

    .subtitle {
      margin: 4px 0 16px;
      font-size: 0.95rem;
      color: #e5e7eb;
      text-align: center;
    }

    .subtitle strong {
      color: #facc15;
    }

    .top-row {
      display: flex;
      gap: 10px;
      margin-top: 8px;
      align-items: center;
    }

    .input-wrap {
      flex: 1;
    }

    label {
      display: block;
      text-align: left;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }

    input[type="email"] {
      width: 100%;
      padding: 10px 14px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.92rem;
      outline: none;
      transition: border-color 0.18s, box-shadow 0.18s, transform 0.06s;
      background: #f9fafb;
    }

    input[type="email"]:focus {
      border-color: #16a34a;
      box-shadow: 0 0 0 2px rgba(22,163,74,0.28);
      transform: translateY(-1px);
      background: #ffffff;
    }

    .hint {
      text-align: left;
      font-size: 0.75rem;
      color: #6b7280;
      margin-top: 2px;
    }

    button {
      border: none;
      border-radius: 999px;
      padding: 9px 18px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.18s, transform 0.08s, box-shadow 0.18s;
      font-family: inherit;
    }

    button:active {
      transform: translateY(1px);
      box-shadow: none;
    }

    .btn-primary {
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #ffffff;
      box-shadow: 0 6px 14px rgba(21,128,61,0.45);
      white-space: nowrap;
    }

    .btn-primary:hover {
      background: linear-gradient(135deg, #16a34a, #15803d);
    }

    .btn-primary:disabled {
      background: #9ca3af;
      box-shadow: none;
      cursor: not-allowed;
    }

    .status {
      min-height: 18px;
      font-size: 0.85rem;
      margin: 10px 0 2px;
      text-align: center;
    }
    .status.error { color: #fecaca; }
    .status.success { color: #bbf7d0; }

    .wheel-section {
      margin-top: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .pointer {
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 24px solid #f97373;
      margin-bottom: 6px;
      filter: drop-shadow(0 3px 4px rgba(0,0,0,0.35));
    }

    #wheel {
      width: 240px;
      height: 240px;
      border-radius: 50%;
      margin: 0 auto 14px;
      border: 10px solid #0f172a;
      background: conic-gradient(
        #f97373 0deg 72deg,
        #fb923c 72deg 144deg,
        #facc15 144deg 216deg,
        #22c55e 216deg 288deg,
        #38bdf8 288deg 360deg
      );
      box-shadow:
        0 16px 26px rgba(15,23,42,0.5),
        inset 0 0 20px rgba(0,0,0,0.35);
      transition: transform 4s cubic-bezier(0.22, 0.61, 0.36, 1);
      position: relative;
      overflow: hidden;
    }

    #wheel::after {
      content: "";
      position: absolute;
      inset: 26%;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.4) 0, transparent 60%);
      pointer-events: none;
    }

    .spin-btn-wrap {
      margin-top: 4px;
    }

    .btn-spin {
      background: linear-gradient(135deg, #b91c1c, #ef4444);
      color: #fef9c3;
      padding-inline: 32px;
      box-shadow: 0 6px 16px rgba(185,28,28,0.55);
    }

    .btn-spin:hover:not(:disabled) {
      background: linear-gradient(135deg, #991b1b, #dc2626);
    }

    .btn-spin:disabled {
      background: #9ca3af;
      box-shadow: none;
      cursor: not-allowed;
    }

    .note {
      font-size: 0.78rem;
      color: #e5e7eb;
      margin-top: 8px;
      text-align: center;
    }

    .result-box {
      margin-top: 20px;
      padding: 16px 16px 14px;
      border-radius: 16px;
      background: #f0fdf4;
      border: 1px solid #bbf7d0;
      text-align: left;
      display: none;
      position: relative;
      overflow: hidden;
    }

    .result-box::before {
      content: "üéÅ";
      position: absolute;
      font-size: 40px;
      opacity: 0.15;
      right: 12px;
      top: 12px;
    }

    .result-box h2 {
      margin: 0 0 4px;
      font-size: 1.05rem;
      color: #166534;
    }

    .result-box h3 {
      margin: 4px 0 8px;
      font-size: 1rem;
      color: #14532d;
    }

    .result-box ul {
      margin: 4px 0 6px 18px;
      padding: 0;
      font-size: 0.9rem;
    }

    .result-box p {
      margin: 4px 0 0;
      font-size: 0.8rem;
      color: #374151;
    }

    /* Confetti pieces */
    .confetti {
      position: fixed;
      width: 8px;
      height: 14px;
      background: #f97373;
      top: -20px;
      border-radius: 2px;
      opacity: 0.9;
      z-index: 999;
      pointer-events: none;
      animation: confetti-fall linear forwards;
    }

    @keyframes confetti-fall {
      0%   { transform: translate3d(0, 0, 0) rotateZ(0deg); }
      100% { transform: translate3d(var(--x-move), 105vh, 0) rotateZ(720deg); }
    }

    @media (max-width: 560px) {
      .card {
        margin: 12px;
        padding-inline: 18px;
      }
      h1 {
        font-size: 1.45rem;
      }
      #wheel {
        width: 210px;
        height: 210px;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="title-row">
      <span class="icon">üéÖ</span>
      <h1>Secret Santa Spin</h1>
      <span class="icon">üéÑ</span>
    </div>
    <p class="subtitle">
      Enter your email, then spin to reveal <strong>one secret person</strong> and their <strong>3 gift wishes</strong>.
    </p>

    <div class="top-row">
      <div class="input-wrap">
        <label for="email">Your company email</label>
        <input type="email" id="email" placeholder="you@company.com" />
        <div class="hint">Use the same email you used in the gift wish form.</div>
      </div>
      <button id="startBtn" class="btn-primary">Start</button>
    </div>

    <div id="status" class="status"></div>

    <div class="wheel-section">
      <div class="pointer"></div>
      <div id="wheel"></div>
      <div class="spin-btn-wrap">
        <button id="spinBtn" class="btn-spin" disabled>Spin üéÅ</button>
      </div>
      <div class="note">
        The colourful wheel is just for fun ‚Äî the actual person is randomly chosen from everyone who filled the form.
      </div>
    </div>

    <div id="resultBox" class="result-box"></div>
  </div>

  <script>
    // üîó Replace this with your real Apps Script URL
    const APP_URL = "https://script.google.com/macros/s/AKfycbxMBCmqgAdaj0EHujj_Y6I2Oqt7Pm5Qgp_2suiuK0JxpzOJcUcOZRDsBw7Vz413HerO/exec";

    let backendResponse = null;
    let spinning = false;

    const emailInput = document.getElementById("email");
    const startBtn = document.getElementById("startBtn");
    const spinBtn = document.getElementById("spinBtn");
    const statusEl = document.getElementById("status");
    const wheel = document.getElementById("wheel");
    const resultBox = document.getElementById("resultBox");

    function setStatus(msg, type) {
      statusEl.textContent = msg || "";
      statusEl.className = "status";
      if (type) statusEl.classList.add(type);
    }

    // üéâ Simple confetti launcher
    function launchConfetti() {
      const colors = ["#f97373","#fb923c","#facc15","#22c55e","#38bdf8","#e879f9"];
      const count = 80;
      for (let i = 0; i < count; i++) {
        const el = document.createElement("div");
        el.className = "confetti";
        const left = Math.random() * 100;        // vw
        const xMove = (Math.random() * 40 - 20) + "vw";
        el.style.left = left + "vw";
        el.style.background = colors[Math.floor(Math.random() * colors.length)];
        el.style.animationDuration = (5 + Math.random() * 3) + "s";
        el.style.setProperty("--x-move", xMove);
        document.body.appendChild(el);
        setTimeout(() => el.remove(), 8000);
      }
    }

    startBtn.addEventListener("click", async () => {
      const email = emailInput.value.trim().toLowerCase();
      resultBox.style.display = "none";
      resultBox.innerHTML = "";

      if (!email) {
        setStatus("Please enter your email address.", "error");
        return;
      }

      setStatus("Checking your email with Santa's list‚Ä¶ üéÖ", "");
      startBtn.disabled = true;
      spinBtn.disabled = true;

      try {
        const res = await fetch(APP_URL + "?email=" + encodeURIComponent(email));
        const data = await res.json();
        console.log("API response:", data);
        backendResponse = data;

        // If API doesn't send "success", treat as OK
        const ok = (data.success === undefined) ? true : data.success;

        if (!ok) {
          setStatus(data.error || "Something went wrong.", "error");
          startBtn.disabled = false;
          return;
        }

        if (data.alreadySpun) {
          setStatus("You have already spun earlier. Showing your result again.", "error");
          showResult(data, false);
          startBtn.disabled = false;
          spinBtn.disabled = true;
        } else {
          setStatus("Email confirmed ‚úÖ You can spin once.", "success");
          spinBtn.disabled = false;
          startBtn.disabled = false;
        }
      } catch (err) {
        console.error(err);
        setStatus("Network error. Please try again.", "error");
        startBtn.disabled = false;
      }
    });

    spinBtn.addEventListener("click", () => {
      if (!backendResponse || backendResponse.alreadySpun) return;
      if (spinning) return;

      spinning = true;
      spinBtn.disabled = true;
      setStatus("Spinning the wheel‚Ä¶ üéÅ", "");

      const extra = Math.floor(Math.random() * 360);
      const total = 1440 + extra; // 4 full spins + random

      wheel.style.transform = `rotate(${total}deg)`;

      setTimeout(() => {
        spinning = false;
        setStatus("Your Secret Santa match is revealed below! ‚ú®", "success");
        showResult(backendResponse, true);
      }, 4100);
    });

    function showResult(data, doConfetti) {
      if (!data || !data.receiverName) return;

      const wishes = data.wishes || ["", "", ""];

      resultBox.style.display = "block";
      resultBox.innerHTML = `
        <h2>üéÅ Your person:</h2>
        <h3>${data.receiverName}</h3>
        <p><strong>Their 3 gift wishes:</strong></p>
        <ul>
          <li>${wishes[0] || "(no wish given)"}</li>
          <li>${wishes[1] || "(no wish given)"}</li>
          <li>${wishes[2] || "(no wish given)"}</li>
        </ul>
        <p>Keep this completely secret ü§´ and choose something thoughtful from their list!</p>
      `;

      if (doConfetti) {
        launchConfetti();
      }
    }
  </script>
</body>
</html>
